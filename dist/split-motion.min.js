document.addEventListener("DOMContentLoaded", function () {

  if (!window.gsap || !window.SplitText || !window.ScrollTrigger) {
    console.warn("[SplitMotion] GSAP, ScrollTrigger, or SplitText missing");
    return;
  }

  gsap.registerPlugin(SplitText, ScrollTrigger);

  const PRESETS = {
    "fade-up": { opacity: 0, y: 40 },
    "fade-down": { opacity: 0, y: -40 },
    "fade-left": { opacity: 0, x: 40 },
    "fade-right": { opacity: 0, x: -40 },

    "slide-up": { y: 80 },
    "slide-down": { y: -80 },
    "slide-left": { x: 80 },
    "slide-right": { x: -80 },

    "zoom-in": { opacity: 0, scale: 0.6 },
    "zoom-out": { opacity: 0, scale: 1.4 },

    "rotate-in": { opacity: 0, rotate: 12 },
    "rotate-out": { opacity: 0, rotate: -12 },

    "blur-in": { opacity: 0, blur: 14 },

    cinematic: {
      opacity: 0,
      y: 80,
      blur: 16,
      duration: 1.2,
      ease: "power3.out",
    }
  };

  function init(root = document) {

    const elements = root.querySelectorAll("[data-split]");

    elements.forEach((el) => {

      if (el.__splitAnimated) return;
      el.__splitAnimated = true;

      const mode = el.dataset.mode ?? "words";
      const split = new SplitText(el, { type: mode });

      const targets =
        mode === "chars"
          ? split.chars
          : mode === "lines"
          ? split.lines
          : split.words;

      let presetConfig = {};

      Object.keys(PRESETS).forEach((preset) => {
        if (el.hasAttribute(`data-${preset}`)) {
          presetConfig = PRESETS[preset];
        }
      });

      const config = {
        opacity: Number(el.dataset.opacity ?? presetConfig.opacity ?? 0),
        x: Number(el.dataset.x ?? presetConfig.x ?? 0),
        y: Number(el.dataset.y ?? presetConfig.y ?? 40),
        z: Number(el.dataset.z ?? presetConfig.z ?? 0),
        scale: Number(el.dataset.scale ?? presetConfig.scale ?? 1),
        rotate: Number(el.dataset.rotate ?? presetConfig.rotate ?? 0),
        rotateX: Number(el.dataset.rotateX ?? presetConfig.rotateX ?? 0),
        rotateY: Number(el.dataset.rotateY ?? presetConfig.rotateY ?? 0),
        duration: Number(el.dataset.duration ?? presetConfig.duration ?? 0.4),
        delay: Number(el.dataset.delay ?? 0),
        stagger: Number(el.dataset.stagger ?? 0.08),
        ease: el.dataset.ease ?? presetConfig.ease ?? "power2.out",
        filter: `blur(${el.dataset.blur ?? presetConfig.blur ?? 0}px)`
      };

      if (el.dataset.scroll !== "false") {
        config.scrollTrigger = {
          trigger: el,
          start: el.dataset.start ?? "top 80%",
          end: el.dataset.end ?? "bottom top"
        };
      }

      gsap.from(targets, config);

    });
  }

  // Auto init
  init();

  // Optional: expose global API
  window.SplitMotion = { init };

});
